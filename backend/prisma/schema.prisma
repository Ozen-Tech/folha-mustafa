generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  createdAt DateTime @default(now())
}

model Funcionario {
  id             String           @id @default(cuid())
  nome           String
  cpf            String           @unique
  email          String?
  dataAdmissao   DateTime
  ativo          Boolean          @default(true)
  salario        Float            @default(0)
  funcao         String?
  chavePix       String?
  tipoVinculo    String           @default("CLT")
  cidade         String?
  estado         String?
  loja           String?
  supervisor     String?
  valeTransporte Boolean          @default(false)
  ajudaCusto     Boolean          @default(false)
  valorAjudaCusto Float           @default(0)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  folhas     FolhaFuncionario[]
  contratos  Contrato[]
  distratos  Distrato[]
  ferias     Ferias[]
}

model Contrato {
  id              String   @id @default(cuid())
  funcionarioId   String
  descricao       String?
  dataInicio      DateTime
  dataVencimento  DateTime
  loja            String?
  cidade          String?
  estado          String?
  supervisor      String?
  arquivoPdf      String?
  ativo           Boolean  @default(true)
  createdAt       DateTime @default(now())

  funcionario Funcionario @relation(fields: [funcionarioId], references: [id], onDelete: Cascade)
}

model Distrato {
  id              String   @id @default(cuid())
  funcionarioId   String
  descricao       String?
  dataDistrato    DateTime
  motivo          String?
  createdAt       DateTime @default(now())

  funcionario Funcionario @relation(fields: [funcionarioId], references: [id], onDelete: Cascade)
}

model Ferias {
  id              String   @id @default(cuid())
  funcionarioId   String
  dataInicio      DateTime
  dataFim         DateTime
  observacao      String?
  createdAt       DateTime @default(now())

  funcionario Funcionario @relation(fields: [funcionarioId], references: [id], onDelete: Cascade)
}

model Competencia {
  id     String   @id @default(cuid())
  ano    Int
  mes    Int
  folhas FolhaPagamento[]

  @@unique([ano, mes])
}

model FolhaPagamento {
  id            String   @id @default(cuid())
  competenciaId String
  fechada       Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  competencia Competencia        @relation(fields: [competenciaId], references: [id], onDelete: Cascade)
  itens       FolhaFuncionario[]
}

model FolhaFuncionario {
  id                String   @id @default(cuid())
  folhaPagamentoId  String
  funcionarioId     String
  salarioBruto      Float    @default(0)
  totalProventos    Float    @default(0)
  totalDescontos    Float    @default(0)
  baseInss          Float    @default(0)
  valorInss         Float    @default(0)
  baseIrrf          Float    @default(0)
  valorIrrf         Float    @default(0)
  salarioLiquido    Float    @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  folhaPagamento FolhaPagamento @relation(fields: [folhaPagamentoId], references: [id], onDelete: Cascade)
  funcionario    Funcionario    @relation(fields: [funcionarioId], references: [id], onDelete: Cascade)
  lancamentos    Lancamento[]
  pagamentos     Pagamento[]
}

model TipoLancamento {
  id         String   @id @default(cuid())
  codigo     String   @unique
  nome       String
  tipo       String
  incideInss Boolean  @default(true)
  incideIrrf Boolean  @default(true)
  lancamentos Lancamento[]
}

model Lancamento {
  id                 String   @id @default(cuid())
  folhaFuncionarioId String
  tipoLancamentoId   String
  valor              Float
  referencia         String?

  folhaFuncionario FolhaFuncionario @relation(fields: [folhaFuncionarioId], references: [id], onDelete: Cascade)
  tipoLancamento   TipoLancamento   @relation(fields: [tipoLancamentoId], references: [id], onDelete: Restrict)
}

model Pagamento {
  id                 String    @id @default(cuid())
  folhaFuncionarioId String
  dataPagamento      DateTime?
  pago               Boolean   @default(false)
  createdAt          DateTime  @default(now())

  folhaFuncionario FolhaFuncionario @relation(fields: [folhaFuncionarioId], references: [id], onDelete: Cascade)
}

model ParametroFolha {
  id        String @id @default(cuid())
  ano       Int
  descricao String
  tipo      String
  faixas    String
  @@unique([ano, tipo])
}
